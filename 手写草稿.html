<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        var arr = [{
                'id': 1,
                'parentid': 0
            },
            {
                'id': 4,
                'parentid': 2
            },
            {
                'id': 3,
                'parentid': 1
            },
            {
                'id': 5,
                'parentid': 0
            },
            {
                'id': 6,
                'parentid': 0
            },
            {
                'id': 2,
                'parentid': 1
            },
            {
                'id': 7,
                'parentid': 4
            },
            {
                'id': 8,
                'parentid': 1
            }
        ];

        function unflatten(arr) {
            debugger;
            var tree = [],
                mappedArr = {},
                arrElem,
                mappedElem;

            // First map the nodes of the array to an object -> create a hash table.
            for (var i = 0, len = arr.length; i < len; i++) {
                arrElem = arr[i];
                mappedArr[arrElem.id] = arrElem;
                mappedArr[arrElem.id]['children'] = [];
            }

            console.log(mappedArr,'-----------mappedArr')
            for (var id in mappedArr) {
                if (mappedArr.hasOwnProperty(id)) {
                    console.log(id,'-----------id')
                    mappedElem = mappedArr[id];
                    // If the element is not at the root level, add it to its parent array of children.
                    if (mappedElem.parentid) {
                        mappedArr[mappedElem.parentid].children.push(mappedElem);
                    }
                    // If the element is at the root level, add it to first level elements array.
                    else {
                        tree.push(mappedElem);
                    }
                }
            }
            return tree;
        }

        var tree = unflatten(arr);
        console.log(tree,'...............tree')
    </script>
</body>

</html>